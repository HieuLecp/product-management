extends ../../layouts/default

block main 
    h1 T·ªïng quan

    .dashboard
        .row.mt-4 
            .col-10 
                .card.mb-4 
                    .card-header T·ªïng quan
                    .card-body.stats
                        .stat-card.blue
                            - var product = statistic.products[0]
                            h3 S·∫£n ph·∫©m b√°n ch·∫°y nh·∫•t
                            img(src=product.thumbnail, alt="", width="80", height="auto")
                            h3 <b>#{product.title}</b>
                            h3 ƒê√£ b√°n: <b>#{product.sold}</b>

                        .stat-card.purple
                            h3 Doanh thu 
                            h3 Trong ng√†y: <b>#{statistic.totalRevenue.inDay} VND</b>
                            h3 Trong th√°ng: <b>#{statistic.totalRevenue.inMonth} VND</b>

                        .stat-card.red
                            h3 S·ªë l∆∞·ª£ng ng∆∞·ªùi d√πng
                            h3 T·∫•t c·∫£: <b>#{statistic.user.total}</b>
                            h3 ƒêang truy c·∫≠p: <b>#{statistic.user.statusOnline}</b>

        .row.mt-4
            .col-md-10
                .card.mb-4 
                    .card-header ƒê·ªì th·ªã
                    .card-body.chart-container
                        h2 üìä Revenue Analytics
                            canvas#revenueChart

                    script.
                        window.onload = function () {
                            const revenueData = !{JSON.stringify(statistic.revenuePerDay || [])};

                            if (revenueData.length === 0) {
                                console.warn("Kh√¥ng c√≥ d·ªØ li·ªáu doanh thu ƒë·ªÉ hi·ªÉn th·ªã bi·ªÉu ƒë·ªì.");
                                return;
                            }

                            const labels = revenueData.map(item => item._id);
                            const data = revenueData.map(item => item.totalRevenue);

                            const ctx = document.getElementById('revenueChart').getContext('2d');
                            new Chart(ctx, {
                                type: 'line',
                                data: {
                                    labels: labels,
                                    datasets: [{
                                        label: 'Doanh thu theo ng√†y (VND)',
                                        data: data,
                                        borderColor: 'rgba(75, 192, 192, 1)',
                                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                        borderWidth: 2
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    scales: {
                                        y: { beginAtZero: true }
                                    }
                                }
                            });
                        };

        .row.mt-4            
            .col-md-10
                .card.mb-4 
                    .card-header Top 5 s·∫£n ph·∫©m b√°n ch·∫°y
                    .card-body.recent-orders
                        h2 üõí Recent Orders
                        table
                            thead
                                tr
                                    th STT
                                    th ·∫¢nh
                                    th Ti√™u ƒë·ªÅ
                                    th Gi√°
                                    th ƒê√£ b√°n
                            tbody
                                if(statistic.products.length > 0)
                                each item, index in statistic.products.slice(0, 5)
                                    tr
                                        td #{index + 1}
                                        td 
                                            img(src=item.thumbnail, alt=item.title, width="80", height="auto")
                                        td #{item.title}
                                        td #{item.price}
                                        td #{item.sold}


block script
    script(src="https://cdn.jsdelivr.net/npm/chart.js")

