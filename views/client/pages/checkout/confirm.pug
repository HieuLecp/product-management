extends ../../layouts/default.pug
include ../../mixins/box-head
include ../../mixins/alert

block main
  .checkout-page
    +alert-success(3000)
    +alert-error(3000)

    .container.mb-5
      .row
        .col-12
          +box-head("Xác nhận đơn hàng", "bg-gradient text-white rounded-top")

      .row
        .col-12
          .card.shadow-sm.rounded
            .card-body
              if products.length > 0
                table(class="table table-striped table-hover text-center align-middle")
                  thead
                    tr
                      th STT
                      th Ảnh
                      th Tên
                      th Giá (vnd)
                      th Số lượng
                      th Thành tiền (vnd)
                  tbody
                    each product, index in products
                      tr
                        td #{index + 1}
                        td
                          img(src=product.thumbnail alt=product.title width="80px" class="rounded")
                        td
                          span #{product.title}
                        td #{product.price.toLocaleString('vi-VN')}
                        td #{product.quantity}
                        td #{(product.priceNew * product.quantity).toLocaleString('vi-VN')}
                .card-footer.bg-light.text-right
                  h4 Tổng đơn hàng: 
                    span.text-danger #{totalPrice.toLocaleString('vi-VN')} (vnd)
              else
                .card-body.text-center.p-5
                  h5.text-muted Không có sản phẩm để xác nhận.
                  a.btn.btn-warning.mt-3(href="/cart") Quay lại giỏ hàng

      if products.length > 0
        .row.mt-4
          .col-12
            .card.shadow-sm.rounded
              .card-header.bg-success.text-white
                h4.text-center Thông tin khách hàng
              .card-body
                .row.g-3
                  .col-md-6
                    .form-group
                      label
                        i.bi.bi-person-fill.me-2
                        | Họ tên
                      p.form-control-static #{userInfo.fullName}
                  .col-md-6
                    .form-group
                      label
                        i.bi.bi-telephone-fill.me-2
                        | Số điện thoại
                      p.form-control-static #{userInfo.phone}
                  .col-md-12
                    .form-group
                      label
                        i.bi.bi-geo-alt-fill.me-2
                        | Địa chỉ nhận hàng
                      p.form-control-static #{userInfo.address}
                  .col-md-12
                    .form-group
                      label
                        i.bi.bi-credit-card-fill.me-2
                        | Phương thức thanh toán
                      p.form-control-static #{paymentType === 'momo' ? 'MoMo' : paymentType === 'zalopay' ? 'ZaloPay' : 'Thanh toán khi nhận hàng (COD)'}
                if paymentType === 'cod'
                  .alert.alert-info.text-center.mt-3 Thanh toán <b>tiền mặt</b> khi nhận hàng. Vui lòng chuẩn bị đủ tiền mặt.
                else if paymentType === 'momo'
                  .alert.alert-info.text-center.mt-3 Thanh toán qua <b>MoMo</b>. Bạn sẽ được chuyển hướng.
                else if paymentType === 'zalopay'
                  .alert.alert-info.text-center.mt-3 Thanh toán qua <b>ZaloPay</b>. Bạn sẽ được chuyển hướng.

                form(action="/checkout/confirm-order" method="POST")
                  input(type="hidden" name="userId" value=userId)
                  input(type="hidden" name="cartId" value=cartId)
                  input(type="hidden" name="productIds" value=productIds)
                  input(type="hidden" name="paymentType" value=paymentType)
                  each value, key in userInfo
                    input(type="hidden" name=key value=value)
                  button(type="submit" class="btn btn-success btn-lg w-100 mt-4 rounded-pill") Xác nhận đơn hàng
                  a.btn.btn-danger.btn-lg.w-100.mt-2.rounded-pill(href="/cart") Hủy