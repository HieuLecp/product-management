extends ../../layouts/default.pug
include ../../mixins/box-head
include ../../mixins/product-layout
include ../../mixins/alert

block main
    .checkout-page
        +alert-success(3000)
        +alert-error(3000)

        .container.mb-5
            .row
                .col-12
                    +box-head("Đặt hàng", "bg-gradient text-white rounded-top")

            .row
                .col-12
                    .card.shadow-sm.rounded
                        .card-body
                            if cartDetail.products.length > 0
                                table(class="table table-striped table-hover text-center align-middle")
                                    thead
                                        tr
                                            th STT
                                            th Ảnh
                                            th Tên
                                            th Giá (vnd)
                                            th Số lượng
                                            th Tổng tiền (vnd)
                                    tbody
                                        each item, index in cartDetail.products
                                            tr
                                                td #{index + 1}
                                                td
                                                    img(src=item.productInfo.thumbnail, alt="sp1" width="80px" class="rounded")
                                                td
                                                    span #{item.productInfo.title}
                                                td #{item.productInfo.priceNewFormat}
                                                td #{item.quantity}
                                                td #{item.totalPriceFormat}
                                .card-footer.bg-light.text-right
                                    h4 Tổng đơn hàng: <span class="text-danger">#{cartDetail.totalPriceFormat}</span> (vnd)
                            else
                                .card-body.text-center.p-5
                                    h5.text-muted Giỏ hàng trống.
                                    a.btn.btn-warning.mt-3(href="/product") Mua sắm ngay

            if cartDetail.products.length > 0
                .row.mt-4
                    .col-12
                        .card.shadow-sm.rounded
                            .card-header.bg-success.text-white
                                h4.text-center Thông tin đặt hàng
                            .card-body
                                form(action="/checkout/order" method="POST" class="needs-validation" novalidate)
                                    input(type="hidden" name="productIds" value=listProductId.join(","))
                                    .row.g-3
                                        .col-md-6
                                            .form-group
                                                label(for="fullName")
                                                    i.bi.bi-person-fill.me-2
                                                    | Họ tên
                                                input(type="text" class="form-control rounded-pill" id="fullName" name="fullName" required)
                                                span(id="fullNameError" class="error-message text-danger")
                                        .col-md-6
                                            .form-group
                                                label(for="phone")
                                                    i.bi.bi-telephone-fill.me-2
                                                    | Số điện thoại
                                                input(type="text" class="form-control rounded-pill" id="phone" name="phone" required)
                                                span(id="phoneError" class="error-message text-danger")
                                        .col-md-12
                                            .form-group
                                                label(for="address")
                                                    i.bi.bi-geo-alt-fill.me-2
                                                    | Địa chỉ nhận hàng
                                                input(type="text" class="form-control rounded-pill" id="address" name="address" required)
                                        .col-md-12
                                            .form-group
                                                label(for="paymentType")
                                                    i.bi.bi-credit-card-fill.me-2
                                                    | Phương thức thanh toán
                                                select(class="form-control rounded-pill" id="paymentType" name="paymentType" onchange="togglePaymentSection()" required)
                                                    option(value="" selected) --Chọn--
                                                    option(value="cod") Thanh toán khi nhận hàng (COD)
                                                    option(value="momo") Thanh toán qua MoMo
                                                    option(value="zalopay") Thanh toán qua ZaloPay
                                    #paymentDetails.mt-3(style="display: none;")
                                        .alert.alert-info.text-center Nhấn "Đặt hàng" để xác nhận phương thức thanh toán.
                                        #codPayment(style="display: none;" class="mt-2")
                                            p.text-center Thanh toán <b>tiền mặt</b> khi nhận hàng. Vui lòng chuẩn bị đủ tiền mặt.
                                        #momoPayment(style="display: none;" class="mt-2")
                                            p.text-center Thanh toán qua <b>MoMo</b>. Bạn sẽ được chuyển hướng.
                                        #zalopayPayment(style="display: none;" class="mt-2")
                                            p.text-center Thanh toán qua <b>ZaloPay</b>. Bạn sẽ được chuyển hướng.
                                    button(type="submit" class="btn btn-success btn-lg w-100 mt-4 rounded-pill") Đặt hàng

        script(src="/js/checkout.js")